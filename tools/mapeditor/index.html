<!--
CalcRace - Get better in mental calculation while having some fun !
Copyright (C) 2022  Mibi88

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see https://www.gnu.org/licenses/.
-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>MapEdit</title>
        <style>
            tr, th, td {
                padding: 0px;
                border: 1px solid;
            }
            image {
                padding: 0px;
                margin: 0px;
            }
            table {
                border-spacing: 0px 0px;
                font-family: sans;
            }
            div {
                font-family: sans;
                image-rendering: moz-crisp-edges;
                image-rendering: pixelated;
                padding: 0px;
                margin: 0px;
                scrollbar-width: thin;
            }
            code {
                font-family: monospace;
                font-size: 10pt;
                display: block;
                height: calc(100% - 12pt - 18pt - (6px * 2));
                width: calc(100% - 5px);
                overflow: scroll;
                margin: 0px;
                padding: 0px;
                border: none;
                border-bottom: 1px #DDDDDD solid;
                scrollbar-width: thin;
            }
            h2 {
                position: sticky;
                top: 0px;
                background-color: #FFFFFF;
                margin: 0px;
                padding: 6px;
                font-size: 18pt;
                border-bottom: 1px #DDDDDD solid
            }
            #sidepanel {
                top: 51px;
                right: 0px;
                width: calc(30% - 10px);
                height: calc(100vh - 51px);
                overflow: scroll;
                background-color: #FFFFFF;
                position: fixed;
                border-top: 1px solid;
                border-left: 1px solid;
                scrollbar-width: thin;
            }
            #sticky {
                position: sticky;
                top: 0px;
                left: 0px;
                background-color: #FFFFFF;
            }
            textarea {
                resize: none;
                width: calc(100% - 5px);
                height: calc(100% - 12pt - 21pt - 18pt - (6px * 2));
                margin: 0px;
                padding: 0px;
                border: none;
                border-bottom: 1px #DDDDDD solid;
                overflow: scoll;
                scrollbar-width: thin;
            }
            button {
                height: 16pt;
                margin: 0px;
                margin-top: 1pt;
                margin-bottom: 4pt;
                margin-right: 4pt;
                padding: 1pt;
                border: 1px #DDDDDD solid;
                background-color: #FFFFFF;
                box-shadow: 2pt 2pt #AAAAAA;
            }
            button:hover {
                background-color: #DDDDDD;
                box-shadow: 2pt 2pt #999999;
            }
            button:active {
                border: 1px #AAAAAA solid;
                background-color: #AAAAAA;
                box-shadow: 2pt 2pt #777777;
            }
        </style>
    </head>
    <body style = "margin-top: 41px;">
        <div style="width: 100%; height: 50px; top: 10px; overflow: scroll;
            position: fixed;">
            <table id = "choice" style = "background-color: white;">
            </table>
        </div>
        <div style="width: 70%; height: calc(100vh - 61px); top: 51px;
            overflow: scroll; position: fixed;">
            <table border id = "table">
                <!-- -->
            </table>
        </div>
        <script>
            tilenum = 1;
            let mapdata = Array();
            table = document.getElementById("choice");
            line = document.createElement("tr");
            table.append(line);
            for(y=0;y<8;y++){
                    for(x=0;x<8;x++){
                            td = document.createElement("td");
                            div = document.createElement("div");
                            div.setAttribute("onclick", "tilenum = " +
                                String(y*8+x+1));
                            div.style = "background-image: " +
                                "url('../../img/world1.png'); " +
                                "background-position: -" + String(x*32) +
                                "px -" + String(y*32) + "px; width: 32px; " +
                                "height: 32px;";
                            td.append(div);
                            line.append(td);
                    }
            }
        </script>
        <div id="sidepanel">
            <h2>Output</h2>
            <code id = "out"></code>
            <h2>Input</h2>
            <textarea id = "input"></textarea>
            <button onclick = "load();">Load</button>
        </div>
        <script>
            function generatemap() {
                var mapstr = "const unsigned char[3840] = {";
                for(i=0;i<3840;i++){
                    cell = String(mapdata[i]);
                    mapstr += cell + ", ";
                };
                mapstr = mapstr.slice(0, -2);
                mapstr += "};";
                out = document.getElementById("out");
                out.innerHTML = mapstr;
            }
            function load() {
                code_str = document.getElementById("input").value;
                strdata = "";
                var grab = 0;
                for(i=0;i<code_str.length;i++){
                    if(code_str[i] == "}"){
                        break;
                    }
                    if(grab){
                        strdata += code_str[i];
                    }
                    if(code_str[i] == "{"){
                        grab = 1;
                    }
                }
                let data = strdata.split(", ");
                mapdata = [];
                for(i=0;i<data.length;i++){
                    mapdata.push(Number(data[i]));
                    div = document.getElementById(String(i));
                    div.style = "background-image: " +
                        "url('../../img/world1.png'); background-position: -" +
                        String(((mapdata[i]-1)%8)*32) + "px -" +
                        String(Math.floor((mapdata[i]-1)/8)*32) +
                        "px; width: 32px; height: 32px;";
                }
                for(i=0;i<60*64;i++){
                    if(mapdata[i] == undefined) mapdata[i] = 25;
                    console.log("loop");
                }
                generatemap();
            }
            table = document.getElementById("table");
            line = document.createElement("tr");
            table.append(line);
            for(x=0;x<65;x++){
                header = document.createElement("th");
                header.scope = "column";
                header.id = "sticky";
                header.innerHTML = String(x);
                line.append(header);
            };
            for(y=0;y<60;y++){
                line = document.createElement("tr");
                table.append(line);
                header = document.createElement("th");
                header.scope = "row";
                header.id = "sticky";
                header.innerHTML = String(y+1);
                line.append(header);
                for(x=0;x<64;x++){
                    cell = document.createElement("td");
                    line.append(cell);
                    div = document.createElement("div");
                    div.onclick = onclick="tilenum = " + String(y*8+x);
                    div.style = "background-image: " +
                        "url('../../img/world1.png'); background-position: " +
                        "-0px -96px; width: 32px; height: 32px;";
                    div.id = String(y*64+x);
                    mapdata[y*64+x] = 25;
                    cell.append(div);
                    div.onclick = function(div) {
                        this.style = "background-image: " +
                            "url('../../img/world1.png'); " +
                            "background-position: -" +
                            String(((tilenum-1)%8)*32) + "px -" +
                            String(Math.floor((tilenum-1)/8)*32) +
                            "px; width: 32px; height: 32px;";
                        mapdata[Number(this.id)] = tilenum;
                        generatemap();
                    }
                };
            };
            generatemap();
        </script>
    </body>
</html>
